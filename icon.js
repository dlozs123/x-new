// 图标相关：URL 生成和首页用户渲染
function getIconUrl(userName) {
    // 替换特殊字符 * : / 为 _ 
    let sanitizedName = userName.replace(/[*:/]/g, '_');
    return `https://r4.dlozs.top/images/${sanitizedName}.jpg`;
}

// 手动分类：用户复制粘贴这里
const userCategories = {
    "A芙兰蕾咪": [
        "franruhika",
        "crerp",
        "Haruki50501",
        "srn_111",
        "mimi_puru",
        "emon3146",
        "rulu_py",
        "ainy120",
        "NeN_King",
        "pafe_yuzuran",
        "shirayuki_epe",
        "hosineko00",
        "miya_25cat",
        "USUMENO_",
        "sakipee36",
        "utadori_5108",
        "nagicha_39",
        "Melty_zo",
        "KirBy_Mozzi_",
        "soesoe300",
        "Ougiikun",
        "utyouten_akako",
        "aoi_fujiwara_a",
        "punimeito",
        "ruru_berry2",
        "OMUGIRI_Ztall_",
        "kemochiharu717",
        "parags112",
        "mizillustration",
        "shk_love0422",
        "aoringoooorira_",
        "kutabiretainu",
        "misoice_ramen",
        "sono_nono",
        "rakugakiman2222",
        "Lpis26106",
        "aromalavender42",
        "shONe_Banana",
        "majamari17",
        "remifrakoi",
        "moni_monico_",
        "rukuthii45",
        "konominoco",
        "hyura3",
        "mike_ne",
        "hiyualice240",
        "niseneko21",
        "AtsushiMurasaki",
        "aruo55",
        "beckody1223",
        "unya_draw2",
        "yunwei48741055",
        "kuronekoron2",
        "koroyarou",
        "miya_nitijo",
        "syouzyorevolver",
        "kirerokirororo",
        "tama0104",
        "deruta3diet10",
        "emon_0401",
        "Gunjou_row",
        "toge_moka",
        "_uzunome",
        "264lino1",
        "ceciltite",
        "075wh0",
        "rikatan_kirei",
        "koyuuuyuki717",
        "otohacomet_888",
        "nenene_mama",
        "otoha4634",
        "inasatwi",
        "izayoi_F2202",
        "tear_drops_4",
        "Szl_2000",
        "rikiriki200",
        "RinaSukareltuto",
        "ruaeru",
        "lattemoca_art",
        "rityulate",
        "fuwa_fura95",
        "wheat_retzel",
        "rori82li",
        "awami_yuna51495",
        "anterdel",
        "Arua0918",
        "airisu495",
        "FaydeeScarlet",
        "tomura_amane",
        "NAno_popo02",
        "Yuuki__Hana",
        "shuhatu",
        "rmrafrn_",
        "156Latte",
        "tosakaoil",
        "usatyako",
        "hua88331",
        "QK_rabbit_2",
        "Siomi_403_",
        "fl495ndre",
        "zakozakoY",
        "manmarumikan_",
        "milky17s",
        "wd_kuyokuyo",
        "_PASTEL__",
        "Homura_Me",
        "hiyayakko1188",
        "QZM0903",
        "osyorasyora",
        "_yuuneka",
        "LancerKoi",
        "momoyamariyo",
        "kisetsusuzu",
        "satona_293",
        "mumu_crown",
        "Parfait025",
        "shiinaito1202",
        "arunanoko64",
        "Nagumo_asu",
        "NEKOCAT510",
        "kazamitan",
        "Settei33989",
        "nyanp_neko",
        "s_vileblood",
        "4_aOo0",
        "sakuramia_free",
        "sawararado",
        "Harumi_77162",
        "mzkzmm",
        "Chalco_illust",
        "x_s2_UTxTU_s2_x",
        "yume_aka314",
        "HaYuk0",
        "moja4192",
        "masakamea",
        "FuyuAkatsuki_00",
        "koishi07734",
        "Sakura_mea_",
        "pure_fumituki",
        "uumaru_uu",
        "WVTj73lGXvUJggy",
        "higashi_1019",
        "Seiryo0425",
        "8HjgW3XAaN92729",
        "Lab2linch",
        "Barcagacha",
        "refi0429",
        "merihari07",
        "kodou_irast",
        "TqGA3wIg4Q61080",
        "ninzin_88hon",
        "dyon_McClane",
        "UNIME_seaflower",
        "mochinue",
        "bhmiK19kZ760940",
        "Redd__009",
        "huako31",
        "nyako94386",
        "XzokutaiX",
        "amagi626",
        "millymiruru",
        "1031_secret",
        "odore_sekai",
        "momohana_3939",
        "hiya__hira",
        "caramell0501",
        "jcs_starfish",
        "beni_hari1110",
        "hch8_atB",
        "tofuandsoup",
        "G2_atelier",
        "Tsaamon_2",
        "yabuinu_mmder",
        "nepperoni",
        "kisaragimikuru",
        "bullet_palette",
        "shagura_yo",
        "Gakubuchi_9",
        "neccoii",
        "Ringoamesan09",
        "sakatsukirori",
        "hinatsuki_83",
        "lasp_0810",
        "o_o0o24",
        "kinagi_suzumori",
        "ghostipi",
        "P_violet_mimi",
        "kamati0maru",
        "serichii4",
        "oinari_33",
        "tomo_hatopo",
        "25omega25",
        "syoboikarasu",
        "_Ko_gyoku",
        "ohayoum__",
        "jz_1221_",
        "kurisu104",
        "syarodio_ganon",
        "dtvisu",
        "yamatyu03",
        "x11dF3",
        "hasuno215",
        "Ocha_bako",
        "YxMHu6wHbq1492",
        "ehu_henzin",
        "Happy90572084",
        "zenerat",
        "MancoKapa9",
        "Lunamoon55",
        "gummy_0617",
        "Purumeria_36",
        "uturo005",
        "Aoi_1013ss",
        "Hawaii1090",
        "___T_A_N_I___",
        "circle_Yomado",
        "coruthi",
        "rite_yo",
        "somein_illust",
        "muric0",
        "okome2028",
        "Shirataki_oden2",
        "choroattohoney",
        "Amasuna_zarame",
        "chronoi_art",
        "waterkkh",
        "39mixberry",
        "Neno_Vi",
        "Haya_s2",
        "zounose",
        "subachoco",
        "riyu_cott",
        "mochip_0",
        "UiIllustrate",
        "sssmamiya",
        "CopperEru",
        "touhourennsyuu",
        "fby1313133",
        "Kazehana621",
        "HamelnFilgaia",
        "kumachoco",
        "pppppks_",
        "Otofu_seller",
        "BVSOOK",
        "Mitarasiudon",
        "siratamako763",
        "ponjusan",
        "NFWTKDaily",
        "watermoon__",
        "nachikarasu",
        "Hoshi_Tea_Party",
        "Tetsu__TTR",
        "TorinoAqua",
        "natsumeruhika",
        "seputok09040904",
        "R_Utchi",
        "samo_yukkuri"
    ],
    "觉恋": [
        "kanno236",
        "zyakusan",
        "yasai_023",
        "who_pu",
        "momoshiki",
        "matcha_yado",
        "superego51",
        "_tanasuke_",
        "rapameri",
        "korokoroudon",
        "nnonnonno_2",
        "sanelta",
        "setsugetsuka436",
        "mint_onyo222",
        "purabird0370",
        "toppoppo1017",
        "kou_baa",
        "noisy_ma",
        "KuzuKirara65432",
        "rabiso_9",
        "nioshi_noai",
        "Teruru_painting",
        "reru_susi",
        "moyasiyde",
        "sgt_Nakamura",
        "NATTOMILKTEA",
        "MoaiXiang59173",
        "rius_Illust",
        "high_meron",
        "tada_nasu2",
        "koruk700",
        "satokoi_suki",
        "Zatugaku_Koishi",
        "zenji029",
        "rokugou",
        "riripika_2525",
        "kasukadoki",
        "neco_no_13",
        "pupu0202b",
        "satorisuki50314",
        "a0_0san",
        "ASAKA_haru123",
        "suzukannn",
        "hamonika_monika",
        "nig_18",
        "toutenkou10105",
        "ramnoyoumou",
        "9_yukino",
        "chikuwa_is_good",
        "kuroha_sinoru",
        "cochan0206",
        "gatikoizei_514",
        "saimu_taju",
        "SereNa_Hutton",
        "ilice_suiten",
        "youkia2237",
        "fantimer",
        "kirika_ze",
        "QebB7Rb9DL9dvUl",
        "enji_you",
        "yagi4696",
        "haco_jimai",
        "Tumadeshi",
        "un_re41",
        "mira_d011",
        "zyannkenn_pon",
        "EODAYO",
        "Ux_xU_666",
        "segen311",
        "dacqazzzzzzz",
        "kyusoukyu",
        "usubenisiro",
        "4_Kilometres",
        "shitace1",
        "Amakaze16",
        "gibuchoko",
        "str11x",
        "kikurisirakami",
        "pheyhyu_0_0",
        "hinoiti",
        "setoka_amakusa",
        "less_lisu",
        "korokorononoko",
        "N1GHTCORD_25",
        "Eir_1248",
        "kaminose_d",
        "suwaneko2",
        "iorin_hyakuya",
        "civichaso",
        "Part1550105",
        "momotari_000",
        "Yogirimiri",
        "ctd_114",
        "AoKinoKo___",
        "siw0n_c",
        "hasami_novelai",
        "IxinRainman",
        "DeFicientRAbbit",
        "ako_oekaki",
        "usamiverse",
        "b_Sanaeosi0730",
        "remonntteumai",
        "HeripanTomorrow",
        "KopiOekaki922",
        "0519_sakana",
        "CHIHIRO94209720",
        "halllki",
        "ohitoriplayer",
        "seika_okawari",
        "guaninekoubou",
        "cyan671",
        "KoroTrishia",
        "Cock_Robin_4",
        "wusem0108",
        "Loki_310_11",
        "Stefinat",
        "Nannkaifan",
        "Soo_kazahana",
        "miumiu8822",
        "Sangria_har",
        "Nise_0v0",
        "KOUYOU_gunkan",
        "miyase_mahiro",
        "mdn_tsugumi",
        "nekokigi",
        "fsxsi97452",
        "Bengsuru",
        "sikitani_sub",
        "tomo_harukaze",
        "animal_seika",
        "Pico_kimuchi",
        "shirazakurammd",
        "5Nikorai",
        "Yurara_a7",
        "masa_tennensui",
        "nagichan515515",
        "turara_project",
        "nana3_bondo",
        "campagne_9"
    ],
    "其他东方": [
        "927013",
        "shiro_5208",
        "wdms_121",
        "pikattoanime",
        "YfJohanne",
        "pudding_028",
        "chidori21",
        "DangYamamoto",
        "nuu_echo",
        "yukinoichimatsu",
        "YutoZin",
        "Aster13838735",
        "misosiru_0224",
        "1draw_roid",
        "ooguni",
        "youmu0225",
        "curemaidcafe",
        "hakurei_sukei",
        "AliceGlint_SE",
        "y8m38",
        "rasra25",
        "maturiuta",
        "Touhou_LW",
        "Touhou_Yomoyama",
        "Futa313255",
        "MAGIARTS0906",
        "Rin_creator",
        "fujimatakuya",
        "ar_qsurmb",
        "remiter00",
        "ruju_amn",
        "ana_ame0",
        "teatei_0424",
        "yurufuwa_milk7",
        "AMNIBUS_STORE",
        "sasamik_",
        "planaria310",
        "VirgoNoSpica",
        "furyu_hm",
        "mizukisoh",
        "s_soul1014",
        "shiratama_chi2",
        "anoneac514",
        "Hika_AliceLove",
        "harutoki2018",
        "purqleclair",
        "papiermesser",
        "OhakoMiv",
        "arnest_",
        "crux_anime",
        "LW_OG3",
        "KTx3rl8o",
        "nanop38",
        "Paranoia495514",
        "eeo_store",
        "Ama_Nuts310",
        "gotoh_510R",
        "AMNIBUS",
        "bushi_PR",
        "Gznf1221",
        "Renyl_",
        "nikoshion",
        "guminemi",
        "animejapan_aj",
        "touhouapple8",
        "Arom_0217",
        "chroo_x",
        "AKIBA_HOBBY2",
        "RokudoRuten",
        "ponkotuREIN",
        "shiroyamayu_ki",
        "dansarasado",
        "chamcham_roze",
        "sumomo_kyawawa",
        "777_kinako",
        "Hydra_BAND_",
        "mist9801KM",
        "umasiodare2",
        "youyume0225",
        "YomyoO_ps",
        "Batory_ken",
        "SONO_1203",
        "nonbiricos",
        "Kisaragi_Koushi",
        "koifrasai",
        "gensoueclipse",
        "oya_oya_18",
        "budou_913",
        "Part1550_sub",
        "_Y_o_h_a_k_u_",
        "beni_kurage12",
        "khk_LW"
    ],
    "舰队": [
        "k_hiro0828",
        "a_greencocoon",
        "lft_kanae22",
        "Ruru179",
        "sugue_304",
        "gatimaya_HKD",
        "naoto_moni",
        "buntan_oic",
        "akitsushima521",
        "kaZC32S",
        "Noel11011015",
        "kaedes",
        "y_makura",
        "sakumogain",
        "fuku_fox",
        "curse02",
        "ri_dy",
        "AI_takurou",
        "sevenrevo0103",
        "azurerain11th",
        "syoukuretin",
        "dagappa1625",
        "Keywing",
        "Sena752653198",
        "mehu_hope",
        "yunamaro32",
        "kodachi_oekaki",
        "sou_diary",
        "hatsukiko_07",
        "hukuhuku0915cat",
        "negahami",
        "setuna_rio",
        "GotoamoonH",
        "_Eminya",
        "u_yuz_xx",
        "soramuko",
        "thor_a_tall",
        "ichi_pg",
        "restia007",
        "junes1121",
        "Tranquillity650",
        "urajios",
        "No23destroyer",
        "HIBIKI_zerocodo",
        "0113_uminin",
        "haigore",
        "konekonelkk",
        "yumeowa",
        "panmodoki10",
        "akoya_001",
        "takomeshix",
        "ebihurya332",
        "kurityou",
        "Torikai_a",
        "MichaelSch55",
        "nocua_kancolle",
        "choco_mince",
        "ruru_illust",
        "akina873",
        "kamaboko903",
        "senobeya",
        "mofunamako",
        "8unowen8",
        "capri134",
        "Sohuzi",
        "oboro_h",
        "rook2605272",
        "mkyk_teapot",
        "maesanpicture",
        "momoniku",
        "natsuki6429",
        "yasin_tgw",
        "pe_sigu_4_9",
        "shigure_only",
        "medara531",
        "Kz_kuzu",
        "yukin0128",
        "poipoi_purin",
        "Neve_0218",
        "kuronagalong",
        "shanghmely2525",
        "suzui_narumi",
        "knkhnp",
        "hachi_karintou",
        "kamiyan191969",
        "hata_mine",
        "calicchio23",
        "komatan",
        "raymie0124",
        "zomzombie22",
        "kujouitiso",
        "shin_kyogoku",
        "38_colis",
        "sabinuki_tabibi",
        "michizane_sgawl",
        "miamia810",
        "alex203815",
        "chrosuke",
        "shigatsu_itsuka",
        "sei_kousen",
        "Alefrain_ht",
        "Stativ_HtKappa",
        "white_ss_yu"
    ],
    "其它": [
        "tatu6120",
        "kimishima_ao",
        "ywwuyi",
        "Guarez_",
        "KanColle_STAFF",
        "decocharaseal",
        "satsuki3506",
        "mathlava",
        "_gamuo_",
        "ura530",
        "esureki",
        "kyty_ikn",
        "shiroshironao",
        "ZECOXZECO",
        "natsukit",
        "15citron",
        "isyoukenmei",
        "minatoaqua",
        "umaiyo_puyoman",
        "Phat_stuff",
        "HAN390831",
        "tacoske_sub",
        "Asa_Error",
        "cassecade",
        "yukino0940",
        "amane0430",
        "chaohead",
        "RabiRibiGame",
        "nemnemru",
        "black_kaneko",
        "tochi_pikonome",
        "key_official",
        "daybreakkid",
        "akausagi_1211",
        "higuma_8086",
        "yorincoro",
        "chibinon0123",
        "NIKONIKO_rewon",
        "momodeshuo",
        "dreamingchicke",
        "kanade6129",
        "ga_ta_kun",
        "utuigawa",
        "27Tomy0723",
        "syuzi_kuros",
        "r6M8GAGzPbk7ExH",
        "mao_sirahama",
        "Starduster_910",
        "iktd13_",
        "sevens_story",
        "emyonnu",
        "visualantena",
        "yukimashiro_",
        "bakuPA",
        "canaca_chiyuri",
        "kousetsu_neni",
        "brian1991lokhin",
        "yasuisan45",
        "karubo23",
        "614cthwsbg",
        "frontier_one",
        "kuwananamikana",
        "momo3_star",
        "ratilt_",
        "hanesaki_seika",
        "Hiragana_iroiro",
        "Honokitiliver",
        "Siva1270",
        "yukkieeeeeen",
        "kitoside",
        "fuka_hire",
        "Zouking2",
        "yutori_z71",
        "deepstarhoshimi",
        "Tyutaka0427",
        "tsukimiya_sara",
        "nukinukijapann",
        "itiri",
        "nae_nae_0918",
        "aoiykk",
        "sekai_mooon",
        "mitokuma",
        "domoto64",
        "ominaeshin",
        "imys_staff",
        "kisaragiyu",
        "august_soft",
        "kinakoame_0202",
        "marinauryu",
        "yuuki_sw",
        "MS46ipFPf53384",
        "_saip_",
        "meshiya_girls",
        "airakasiba",
        "otogi_staff",
        "houk1se1",
        "ksmhope",
        "hiryuukanon",
        "yuasa_akira",
        "abcdeaabcz",
        "suya2mori2",
        "JudgeSpearRF",
        "CEOofTerakomari",
        "yng_hoti",
        "chun_paretto",
        "kachiyori403",
        "momoco_haru",
        "infomaryjane",
        "yua_6ukkr",
        "yomogisoft",
        "gotop12",
        "amatuji_",
        "dreamchild_0504",
        "shion_hnk",
        "Akerei0u0",
        "Rinascita_v",
        "Ryoki_215",
        "SDDC97335649",
        "kuwaharaT_art",
        "naomi_fantasia",
        "osho0079",
        "rakugaki07",
        "reimen_caluna"
    ]
};

async function loadUsers() {
    const data = await getTweetData();
    const users = {};
    data.forEach(tweet => {
        const { screen_name, name } = tweet;
        if (!users[screen_name]) {
            users[screen_name] = { name };
        }
    });

    const userList = document.getElementById('user-list');

    // 为每个类别渲染 section
    Object.keys(userCategories).forEach(category => {
        const categorySection = document.createElement('div');
        categorySection.className = 'category-section';
        const title = document.createElement('h2');
        title.textContent = `${category} 类用户`;
        categorySection.appendChild(title);

        const grid = document.createElement('div');
        grid.className = 'user-grid';
        categorySection.appendChild(grid);

        const categoryUsers = userCategories[category];
        categoryUsers.forEach(screenName => {
            const user = users[screenName];
            if (user) {
                const card = document.createElement('div');
                card.className = 'user-card';
                card.innerHTML = `
                    <img src="${getIconUrl(user.name)}" alt="${user.name}'s avatar">
                    <p>${user.name} (@${screenName})</p>
                `;
                card.onclick = () => {
                    window.location.href = `user.html?screen_name=${screenName}`;
                };
                grid.appendChild(card);
            }
        });

        // 只添加有用户的类别
        if (grid.children.length > 0) {
            userList.appendChild(categorySection);
        }
    });

    // 添加其他用户（未分类）
    const otherSection = document.createElement('div');
    otherSection.className = 'category-section';
    const otherTitle = document.createElement('h2');
    otherTitle.textContent = '其他用户';
    otherSection.appendChild(otherTitle);

    const otherGrid = document.createElement('div');
    otherGrid.className = 'user-grid';
    otherSection.appendChild(otherGrid);

    Object.keys(users).forEach(screenName => {
        if (!Object.values(userCategories).flat().includes(screenName)) {
            const user = users[screenName];
            const card = document.createElement('div');
            card.className = 'user-card';
            card.innerHTML = `
                <img src="${getIconUrl(user.name)}" alt="${user.name}'s avatar">
                <p>${user.name} (@${screenName})</p>
            `;
            card.onclick = () => {
                window.location.href = `user.html?screen_name=${screenName}`;
            };
            otherGrid.appendChild(card);
        }
    });

    if (otherGrid.children.length > 0) {
        userList.appendChild(otherSection);
    }
}